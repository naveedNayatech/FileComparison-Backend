var xlsx = require('node-xlsx');
var _ = require('underscore');

module.exports = function(config) {
	var file1_obj = xlsx.parse(config.file1); // parses a file
	var file2_obj = xlsx.parse(config.file2);

	var file1_itemId = [];
	var file2_itemId = [];

	var filter_item_arr = [];

	_.each(file1_obj.worksheets[0].data, function(item) {
		var file1_itemValArr = [];
		_.each(config.column_file1.column, function (col) {
			
			file1_itemValArr.push(item[col].value);
		})
		var joinVal = file1_itemValArr.join(config.column_file1.join)
		file1_itemId.push(joinVal)
	})


	_.each(file2_obj.worksheets[0].data, function(item) {
		// skip if blank line or value is invalid
		if(!(item == undefined || item[1] == undefined)) {
			var file2_itemValArr = [];

			_.each(config.column_file2.column, function (col) {
				file2_itemValArr.push(item[col].value);
			})
			var joinVal = file2_itemValArr.join(config.column_file2.join)
			file2_itemId.push(joinVal)
		}
	})

	
	_.each(file1_itemId, function(file1_item, index) {
		_.each(file2_itemId, function(file2_item) {
			if(file1_item === file2_item) {
				delete file1_itemId[index]
			}
		})
	})

	_.each(file1_itemId, function(filter_item) {
		if(filter_item !== ''){
			filter_item_arr.push(filter_item);
		}
	})

	return filter_item_arr
}
